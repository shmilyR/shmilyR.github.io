<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>小萌货</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="小萌货">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="小萌货">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小萌货">
  
    <link rel="alternate" href="/atom.xml" title="小萌货" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">小萌货</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-java中的锁" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/29/java中的锁/" class="article-date">
  <time datetime="2018-09-29T11:47:14.000Z" itemprop="datePublished">2018-09-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/29/java中的锁/">java中的锁</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Lock接口"><a href="#Lock接口" class="headerlink" title="Lock接口"></a>Lock接口</h1><p>锁是用来控制多个线程访问共享资源的方式，一般来说，一个锁能够防止多个线程同时访问共享资源(但是有些锁可以允许多个线程并发的访问共享资源，比如读写锁)。在Lock接口出现之前，Java程序是靠synchronized关键字实现锁功能，它提供了与synchronized关键字类似的同步功能，只是在使用时需要显式的获取和释放锁。虽然它缺少了(通过synchronized块或方法所提供的)隐式获取释放锁的便捷性，但是却拥有了锁获取与锁释放的可操作性、可中断的获取锁以及超时获取锁等多种synchronized关键字所不具备的同步特性。<br>使用synchronized关键字将会隐式的获取锁，但是它将锁的获取和释放固定化了，也就是先获取再释放。这种方式简化了同步的管理，但是扩展性没有显式地锁获取和锁释放来地好。<br><strong>Lock的使用：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在finally中释放锁，目的是保证在获取到锁之后，最终能够被释放。<br>不要将获取锁的过程写在try块中，因为如果在获取锁(自定义的实现)时发生了异常，抛出异常的同时，也会导致锁无故释放。<br><strong>Lock接口提供的synchronized关键字不具备的特性：</strong></p>
<table border="2"><br>    <tr><br>        <th>特性</th><br>        <th>描述</th><br>    </tr><br>    <tr><br>        <td ailgn="center">尝试非阻塞的获取锁</td><br>        <td ailgn="center">当前线程尝试获取锁，如果这一时刻没有被其它线程获取锁，则成功获取并持有锁</td><br>    </tr><br>    <tr><br>        <td ailgn="center">能被中断的获取锁</td><br>        <td ailgn="center">与synchronized不同，获取到锁的线程能够响应中断，当获取到锁的线程被中断时，中断异常会将会被抛出，同时锁会被释放</td><br>    </tr><br>    <tr><br>        <td ailgn="center">超时获取锁</td><br>        <td ailgn="center">在指定的截止时间之前获取锁，如果截至时间到了仍旧无法获取锁，则返回。</td><br>    </tr><br></table>

<p>Lock是一个接口，它定义了锁获取和释放的基本操作，API如下：</p>
<table border="2"><br>    <tr><br>        <th>方法名称</th><br>        <th>描述</th><br>    </tr><br>    <tr><br>        <td align="center">void lock()</td><br>        <td align="center">获取锁，调用该方法当前线程将会获取锁，当锁获得后，从该方法返回</td><br>    </tr><br>     <tr><br>        <td align="center">void lockInterruptibly() throws InterruptedException</td><br>        <td align="center">可中断的获取锁，和lock()方法的不同之处在于该方法会响应中断，即在锁的获取中可以中断当前线程。</td><br>    </tr><br>     <tr><br>        <td align="center">boolean tryLock()</td><br>        <td align="center">尝试非阻塞的获得锁，调用该方法后立即返回true，否则返回false</td><br>    </tr><br>     <tr><br>        <td align="center">boolean tryLock(long time,TimeUnit unit) throws InterruptedException</td><br>        <td align="center">超时的获取锁，当前线程在以下三种情况下会返回：<br>1.当前线程在超时时间内获得了锁；<br>2.当前线程在超时时间内被中断<br>3.超时时间结束，返回false</td><br>    </tr><br>     <tr><br>        <td align="center">void unlock()</td><br>        <td align="center">释放锁</td><br>    </tr><br>     <tr><br>        <td align="center">Condition newCondition()</td><br>        <td align="center">获取等待通知组件，该组件与当前的锁绑定，当前线程只有获得了锁，才能调用该组件的wait()方法，而调用后，当前线程将释放锁。</td><br>    </tr><br></table>

<p>Lock接口的基本实现都是通过聚合了一个同步器(AbstractQueuedSynchronizer)的子类来完成线程访问控制的。</p>
<h1 id="队列同步器"><a href="#队列同步器" class="headerlink" title="队列同步器"></a>队列同步器</h1><p>是用来构建锁或者其它同步组件的基础框架。它使用了一个int成员变量表示同步状态，通过内置的FIFO队列来完成资源获取线程的排队工作。<br>同步器的主要使用方式是继承，子类通过继承同步器并实现它的抽象方法来管理同步状态，在抽象方法的实现过程中免不了要对同步状态进行更改，这时就需要使用同步器提供的3个方法(getState()、setState(int newStatus)和compareAndSetState(int expect,int update))来进行操作，因为它们能够保证状态的改变是安全的。子类推荐被定义为自定义同步组件的静态内部类，同步器自身没有没有实现任何同步接口，它仅仅是定义了若干同步状态获取和释放的方法来供自定义同步组件使用，同步器既可以支持独占式地获取同步状态，也可以支持共享式地获取同步状态，这样就可以方便实现不同类型地同步组件(ReentrantLock、ReentrantReadWriteLock和CountDownLock)。<br>同步器是实现锁(也可以是任意同步组件)的关键，在锁的实现中聚合同步器，利用同步器实现锁的语义。可以这样理解两者之间的关系：锁是面向使用者的，它定义了使用者与锁交互的接口，隐藏了实现细节；同步器面向的是锁的实现者，它简化了锁的实现方式，屏蔽了同步状态管理、线程的排队、等待与唤醒等底层操作。锁和同步器很好的隔离了使用者与实现者所需关注的领域。  </p>
<h1 id="队列同步器的接口与示例"><a href="#队列同步器的接口与示例" class="headerlink" title="队列同步器的接口与示例"></a>队列同步器的接口与示例</h1><p>同步器的设计是基于模板方法模式的，也就是说，使用者需要继承同步器并重写指定的方法，随后将同步器组合在自定义同步组件的实现中，并调用同步器提供的模板方法，而这些模板方法将会调用使用者重写的方法。<br>重写同步器指定方法时，需要使用同步器提供的3个方法：</p>
<ul>
<li>getState():获取当前同步状态；</li>
<li>setState(int newState):设置当前同步状态；</li>
<li>compareAndSetState(int expect,int update):使用CAS设置当前状态，该方法能够保证状态设置的原子性。<br>同步器可重写的方法描述：</li>
</ul>
<table border="2"><br>    <tr><br>        <th>方法名称</th><br>        <th>描述</th><br>    </tr><br>    <tr><br>        <td align="center">protected boolean tryAcquire(int arg)</td><br>        <td align="center">独占式获取同步状态，实现该方法需要查询当前状态并判断同步状态是否符合预期，然后再进行CAS设置同步状态</td><br>    </tr><br>        <tr><br>        <td align="center">protected boolean tryRelease(int arg)</td><br>        <td align="center">独占式释放同步状态，等待获取同步状态的线程将有机会获取同步状态</td><br>    </tr><br>        <tr><br>        <td align="center">protected int tryAcquireShared(int arg)</td><br>        <td align="center">共享式获取同步状态，返回大于等于0的值，表示获取成功，反之，获取失败。</td><br>    </tr><br>        <tr><br>        <td align="center">protected boolean tryReleaseShared(int arg)</td><br>        <td align="center">共享式释放同步状态</td><br>    </tr><br>        <tr><br>        <td align="center">protected boolean isHeldExclusively()</td><br>        <td align="center">当前同步器是否在独占模式下被线程占用，一般方法表示是否被当前线程所独占。</td><br>    </tr><br></table>  

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/29/java中的锁/" data-id="cjmndrkg3000174vkt3pbr4e7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/29/hello-world/" class="article-date">
  <time datetime="2018-09-29T10:47:52.968Z" itemprop="datePublished">2018-09-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/29/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/29/hello-world/" data-id="cjmndrkfv000074vkhv5ixu6w" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/09/29/java中的锁/">java中的锁</a>
          </li>
        
          <li>
            <a href="/2018/09/29/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 阿蕊小姐姐<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>